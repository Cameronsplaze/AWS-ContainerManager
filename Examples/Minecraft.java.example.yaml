
Ec2:
  InstanceType: m5.large # 2vCPUs, 8GB RAM

Container:
  # Docs here: https://docker-minecraft-server.readthedocs.io/en/latest/
  Image: itzg/minecraft-server
  Ports:
    - TCP: 25565
    # Only required for GeyserMC Bedrock connections:
    - UDP: 19132
  Environment:
    EULA: True
    TYPE: PAPER
    ## Let the memory limit adjust based on how big the ec2 instance is:
    # https://docker-minecraft-server.readthedocs.io/en/latest/configuration/jvm-options/#memory-limit
    MEMORY: ""
    JVM_XX_OPTS: "-XX:MaxRAMPercentage=75"
    ## Inject this to server.properties, so it's dynamic and tells users when server updates:
    # (since we use the latest version that the plugins allow, it'll be random when we update).
    MOTD: |
      §3The §o§lPerfect§r§3 Minecraft Server
      §r(on §4%VERSION%§r)

    ## From https://docker-minecraft-server.readthedocs.io/en/latest/configuration/misc-options/#openj9-specific-options
    TUNE_VIRTUALIZED: True
    ENABLE_RCON: False

    ## https://docker-minecraft-server.readthedocs.io/en/latest/mods-and-plugins/modrinth/#extra-options
    MODRINTH_DOWNLOAD_DEPENDENCIES: required

    ### Plugins List:
    # geysermc (geyser and floodgate): For letting Bedrock Clients connect to the server. (Including Mobile)
    #    - Each player needs to follow this guide to use bedrock: https://geysermc.org/wiki/floodgate/linking#what-is-global-linking
    ## NOTE: These CAN'T be the modrinth versions. We need the very latest, to let bedrock clients connect.
    #         (But ViaVersion/ViaBackwards should make it work with whatever java version the server is on)
    PLUGINS: |
      https://download.geysermc.org/v2/projects/geyser/versions/latest/builds/latest/downloads/spigot
      https://download.geysermc.org/v2/projects/floodgate/versions/latest/builds/latest/downloads/spigot

    ### MODRINTH MODS:
    # viaversion + viabackwards: Let clients with different versions connect to server.
    #      https://modrinth.com/plugin/viaversion
    #      https://modrinth.com/plugin/viabackwards
    # griefprevention: For land claiming, not actually stopping griefing ironically. We have a whitelist
    #      https://modrinth.com/plugin/griefprevention
    # discordsrv: For Discord integration, like player joins/leaves, chat, etc.
    #      https://modrinth.com/plugin/discordsrv
    MODRINTH_PROJECTS: |
      viaversion
      viabackwards
      griefprevention
      discordsrv
    ## Use maximum version of MC that mods allow:
    VERSION_FROM_MODRINTH_PROJECTS: True


Volumes:
  - Type: EFS # EFS or (eventually) S3. EFS is the default.
    EnableBackups: True
    KeepOnDelete: True
    Paths:
      - Path: /data
        ReadOnly: False

## Config options for how to monitor for players:
# (Only required since we're using BOTH tcp and udp)
Watchdog:
  Threshold: 1175
  InstanceLeftUp:
    DurationHours: 8
    ShouldStop: True

# AlertSubscription:
#   Email: Does@Not.Exist Does@Not.Exist2
